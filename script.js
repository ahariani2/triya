const listingsData = [
  {
    "listingId": 1251152485,
    "title": "Custom Logo Design Confetti | Personalized Small Business Packing Materials, Custom Design Confetti, Business Logo Favors, Bulk Packaging",
    "subtitle": "This adorable confetti will brighten up any local event, party, product packaging, etc.",
    "etsyLink": "https://triyadesigns.etsy.com/listing/1251152485",
    "imageUrl": "https://i.etsystatic.com/8681361/r/il/ae6141/3990757239/il_fullxfull.3990757239_l9tp.jpg",
    "amazonLink": null,
    "tags": [
      "Confetti",
      "All"
    ],
    "badge": "Best Seller",
    "michaelsLink": null,
    "l4Sales": "$127",
    "l52Sales": "$6,201",
    "allTimeSales": "$10,870",
    "bestSellerBadge": "Best Seller",
    "newBadge": null,
    "trendingBadge": "Trending"
  },
  {
    "listingId": 1049257734,
    "title": "Custom Name Confetti | Personalized Text Party Decorations, Party Favors, Hand Lettered Cursive Text, Birthday Decor",
    "subtitle": "Brighten up any celebration with personalized word confetti!",
    "etsyLink": "https://triyadesigns.etsy.com/listing/1049257734",
    "imageUrl": "https://i.etsystatic.com/8681361/r/il/07f8bd/3684749400/il_794xN.3684749400_lch0.jpg",
    "amazonLink": null,
    "tags": [
      "Confetti",
      "All"
    ],
    "badge": "Best Seller",
    "michaelsLink": null,
    "l4Sales": "$242",
    "l52Sales": "$4,505",
    "allTimeSales": "$14,697",
    "bestSellerBadge": "Best Seller",
    "newBadge": null,
    "trendingBadge": "Trending"
  },
  {
    "listingId": 1198527768,
    "title": "Trash and Recycling Decals | Trash Can Labels, Recycle Bin Decal, Waste Decals, DIY Trash Can Project | Sticker ONLY | Silver, Black, White",
    "subtitle": "Upgrade your home decor with our minimalist Trash and Recycling icon decals! These are an easy way to DIY your home.",
    "etsyLink": "https://triyadesigns.etsy.com/listing/1198527768",
    "imageUrl": "https://i.etsystatic.com/8681361/r/il/44d4ff/3797683346/il_fullxfull.3797683346_h1gm.jpg",
    "amazonLink": "https://www.amazon.com/dp/B0D7FGYX1W",
    "tags": [
      "Decals",
      "All"
    ],
    "badge": "Best Seller",
    "michaelsLink": null,
    "l4Sales": "$286",
    "l52Sales": "$4,081",
    "allTimeSales": "$9,078",
    "bestSellerBadge": "Best Seller",
    "newBadge": null,
    "trendingBadge": "Trending"
  },
  {
    "listingId": 1293627699,
    "title": "Diamond Ring Confetti | Glitter Silver, Gold, White, Pink Engagement Ring Confetti | Bridal Party Decorations, Bachelorette Party",
    "subtitle": "This adorable confetti will brighten up any engagement celebration, party favor, bachelorette or bridal party, etc.",
    "etsyLink": "https://triyadesigns.etsy.com/listing/1293627699",
    "imageUrl": "https://i.etsystatic.com/8681361/r/il/828cd5/5893449771/il_794xN.5893449771_4mld.jpg",
    "amazonLink": null,
    "tags": [
      "Confetti",
      "All"
    ],
    "badge": "Best Seller",
    "michaelsLink": null,
    "l4Sales": null,
    "l52Sales": "$1,501",
    "allTimeSales": "$7,499",
    "bestSellerBadge": "Best Seller",
    "newBadge": null,
    "trendingBadge": null
  },
  {
    "listingId": 1751446713,
    "title": "Custom Printed Logo Confetti | Personalized Small Business Packing Materials, Custom Design Logo, Business Logo Favors, Bulk Packaging",
    "subtitle": "Celebrate your brand or event in style with our personalized logo confetti! Each piece is printed and cut from white car",
    "etsyLink": "https://triyadesigns.etsy.com/listing/1751446713",
    "imageUrl": "https://i.etsystatic.com/8681361/r/il/2330a4/6077733594/il_fullxfull.6077733594_1e1d.jpg",
    "amazonLink": null,
    "tags": [
      "Confetti",
      "All"
    ],
    "badge": "Best Seller",
    "michaelsLink": null,
    "l4Sales": "$19",
    "l52Sales": "$1,492",
    "allTimeSales": "$1,492",
    "bestSellerBadge": "Best Seller",
    "newBadge": null,
    "trendingBadge": null
  },
  {
    "listingId": 1413192625,
    "title": "Age Confetti | Personalized Year Number Party Decorations, Party Favors, 18, 21, 30, 40, 50 Years, Birthday Decor",
    "subtitle": "Brighten up your birthday, anniversary, or party with our delightful age confetti! This set includes the number of pieces corresponding to your age, all in your color of choice. Whether youâ€™re celebrating a milestone or just adding a fun touch to your event, these confetti pieces are the perfect addition.",
    "etsyLink": "https://triyadesigns.etsy.com/listing/1413192625",
    "imageUrl": "https://i.etsystatic.com/8681361/r/il/1572d5/4608287592/il_794xN.4608287592_3irr.jpg",
    "amazonLink": "https://www.amazon.com/dp/B0BVY2GY7W",
    "tags": [
      "Confetti",
      "All"
    ],
    "badge": "Best Seller",
    "michaelsLink": null,
    "l4Sales": "$103",
    "l52Sales": "$1,363",
    "allTimeSales": "$2,609",
    "bestSellerBadge": "Best Seller",
    "newBadge": null,
    "trendingBadge": "Trending"
  },
  {
    "listingId": 1731898492,
    "title": "Custom 4x6 Professional Photo Prints for Album | Glossy Photo Prints | Personalized Photo Gift | Professional Printing, Your Photos",
    "subtitle": "Preserve Your Memories with a Professional-Grade 4x6 Custom Photo Print",
    "etsyLink": "https://triyadesigns.etsy.com/listing/1731898492",
    "imageUrl": "https://i.etsystatic.com/8681361/r/il/b44072/6101936155/il_794xN.6101936155_q7gt.jpg",
    "amazonLink": null,
    "tags": [
      "Prints",
      "All"
    ],
    "badge": null,
    "michaelsLink": null,
    "l4Sales": "$12",
    "l52Sales": "$547",
    "allTimeSales": "$547",
    "bestSellerBadge": null,
    "newBadge": null,
    "trendingBadge": null
  },
  {
    "listingId": 783061466,
    "title": "2025 Graduation Confetti | Graduation Party Decorations | Set of 40",
    "subtitle": "Celebrate the Class of 2025 with our sparkling glitter graduation confetti! This 40-piece set",
    "etsyLink": "https://triyadesigns.etsy.com/listing/783061466",
    "imageUrl": "https://i.etsystatic.com/8681361/r/il/ef9072/6650644182/il_fullxfull.6650644182_i9e4.jpg",
    "amazonLink": null,
    "tags": [
      "Confetti",
      "All"
    ],
    "badge": "Trending",
    "michaelsLink": null,
    "l4Sales": "$86",
    "l52Sales": "$451",
    "allTimeSales": "$729",
    "bestSellerBadge": null,
    "newBadge": null,
    "trendingBadge": "Trending"
  },
  {
    "listingId": 751581424,
    "title": "Braided Rakhis - Burgundy, Navy, Teal & Gold | Raksha Bandhan Rakhi For Brother",
    "subtitle": "This listing is for one individual rakhi",
    "etsyLink": "https://triyadesigns.etsy.com/listing/751581424",
    "imageUrl": "https://i.etsystatic.com/8681361/r/il/24c1d6/2299831287/il_fullxfull.2299831287_5dtj.jpg",
    "amazonLink": null,
    "tags": [
      "Rakhis",
      "All"
    ],
    "badge": null,
    "michaelsLink": null,
    "l4Sales": "$22",
    "l52Sales": "$447",
    "allTimeSales": "$1,169",
    "bestSellerBadge": null,
    "newBadge": null,
    "trendingBadge": null
  },
  {
    "listingId": 1685276640,
    "title": "Glitter Diamond Ring Confetti | Simple Silver, Gold, White, Pink Engagement Ring Confetti | Bridal Party Decorations, Bachelorette Party",
    "subtitle": "Add a touch of sparkle to your special occasions with our delightful glitter diamond ring confetti! Perfect for engagements",
    "etsyLink": "https://triyadesigns.etsy.com/listing/1685276640",
    "imageUrl": "https://i.etsystatic.com/8681361/r/il/3aa1e1/5924876723/il_fullxfull.5924876723_aepy.jpg",
    "amazonLink": "https://www.amazon.com/dp/B0D214P6HW",
    "tags": [
      "Confetti",
      "All"
    ],
    "badge": null,
    "michaelsLink": null,
    "l4Sales": "$30",
    "l52Sales": "$408",
    "allTimeSales": "$457",
    "bestSellerBadge": null,
    "newBadge": null,
    "trendingBadge": null
  },
  {
    "listingId": 1286771581,
    "title": "Custom Moving States With Text Outline Decal | Two States, Long Distance Map, Moving Gift Vinyl Decal | Sticker ONLY | Laptop/Car Decal",
    "subtitle": "This cute state sticker makes a cute moving gift or decoration for your tumbler, laptop, car, mug, water bottle, journal",
    "etsyLink": "https://triyadesigns.etsy.com/listing/1286771581",
    "imageUrl": "https://i.etsystatic.com/8681361/r/il/118e6c/4132119421/il_fullxfull.4132119421_su1y.jpg",
    "amazonLink": null,
    "tags": [
      "Decals",
      "All"
    ],
    "badge": "Trending",
    "michaelsLink": null,
    "l4Sales": "$35",
    "l52Sales": "$385",
    "allTimeSales": "$1,004",
    "bestSellerBadge": null,
    "newBadge": null,
    "trendingBadge": "Trending"
  },
  {
    "listingId": 1724701982,
    "title": "Gold Initial Rakhi | Burgundy, Gold, White Rakhi with Letter Accent Bead | Rakhi for Brother, Raksha Bandhan Thread | Custom Letter Bracelet",
    "subtitle": "This listing is for one individual rakhi - add more than one to your cart for multiple rakhis or shop one of the pre-mad",
    "etsyLink": "https://triyadesigns.etsy.com/listing/1724701982",
    "imageUrl": "https://i.etsystatic.com/8681361/r/il/142263/6043225392/il_fullxfull.6043225392_cot0.jpg",
    "amazonLink": null,
    "tags": [
      "Rakhis",
      "All"
    ],
    "badge": null,
    "michaelsLink": null,
    "l4Sales": "$0",
    "l52Sales": "$339",
    "allTimeSales": "$339",
    "bestSellerBadge": null,
    "newBadge": null,
    "trendingBadge": null
  },
  {
    "listingId": 831990709,
    "title": "Red Orange & Silver Rakhi Bracelet | Raksha Bandhan 2024 | Red Orange Silver Rakhi For Brother | Triya Designs",
    "subtitle": "This listing is for one individual rakhi bracelet - add more than one to your cart for multiple bracelets or shop one of",
    "etsyLink": "https://triyadesigns.etsy.com/listing/831990709",
    "imageUrl": "https://i.etsystatic.com/8681361/r/il/5d982d/2455079161/il_fullxfull.2455079161_pnh8.jpg",
    "amazonLink": "https://www.amazon.com/dp/B096SS671P",
    "tags": [
      "Rakhis",
      "All"
    ],
    "badge": null,
    "michaelsLink": null,
    "l4Sales": null,
    "l52Sales": "$289",
    "allTimeSales": "$618",
    "bestSellerBadge": null,
    "newBadge": null,
    "trendingBadge": null
  }
];

initializeApp(listingsData);


function initializeApp(listingsData) {


listingsData.forEach(listing => {
  if (listing.title && listing.title.includes('|')) {
    listing.shortenedTitle = listing.title.split('|')[0].trim();
  } else {
    listing.shortenedTitle = listing.title;
  }
          
          listing.rankingOrder = listing.l52Sales ? parseInt(listing.l52Sales.replace('$', '').replace(/,/g, '')) : 0
       
});
        
        /** Constants **/
        const itemListName = 'Physical Product Listings';
        const itemListId = 'listings';
        
        /** Lightbox Item **/
        
        
const lightbox = document.getElementById('product-lightbox');
const lightboxDetailsContainer = document.getElementById('lightbox-details-container');
const closeButton = document.querySelector('.close-button');


function openLightbox(listing) {
  // Populate the lightbox with product details
  lightboxDetailsContainer.innerHTML = `
    <div class="lightbox-image-container">
      <img src="${listing.imageUrl}" alt="${listing.title}">
    </div>
    <div class="lightbox-text-container">
      <h3>${listing.title}</h3>
      <p>${listing.subtitle}</p>
      <div class="lightbox-buttons">
        ${listing.etsyLink ? `<a href="${listing.etsyLink}" target="_blank" class="lightbox-button etsy-button">View on Etsy</a>` : ''}
        ${listing.amazonLink ? `<a href="${listing.amazonLink}" target="_blank" class="lightbox-button amazon-button">View on Amazon</a>` : ''}
        ${listing.michaelsLink ? `<a href="${listing.michaelsLink}" target="_blank" class="lightbox-button michaels-button">View on Michaels</a>` : ''}
      </div>
    </div>
    `;

  lightbox.style.display = 'block'; // Show the lightbox
}

closeButton.addEventListener('click', () => {
  lightbox.style.display = 'none'; // Hide the lightbox
});

// Close the lightbox if the user clicks outside of it
window.addEventListener('click', (event) => {
  if (event.target === lightbox) {
    lightbox.style.display = 'none';
  }
});

      
  /** Filter Bar **/
        
        const filterBar = document.getElementById('filter-bar');

// Function to get unique tags from listingsData
function getUniqueTags() {
  const tags = ['All']; // Always include 'All'
  listingsData.forEach(listing => {
    listing.tags.forEach(tag => {
      if (!tags.includes(tag)) {
        tags.push(tag);
      }
    });
  });
  return tags;
}

        const uniqueTags = getUniqueTags();


// Generate the filter chips dynamically
uniqueTags.forEach(tag => {
  const chip = document.createElement('div');
  chip.classList.add('filter-chip');
  chip.dataset.filter = tag;
  chip.textContent = tag;

  if (tag === 'All') {
    chip.classList.add('active'); // Initially select 'All'
  }

  chip.addEventListener('click', () => {
 //   gtag('event', 'filter_click', { // Track filter click
   //   'filter_tag': tag
 //   });
    
    filterChips.forEach(c => c.classList.remove('active'));
    chip.classList.add('active');
    filterListings(tag);
  });

  filterBar.appendChild(chip);
});

        const filterChips = filterBar.querySelectorAll('.filter-chip');
        
         // Function to display listings based on the selected tag
        function filterListings(tag) {
          const listings = document.querySelectorAll('#listings-list li');
          listings.forEach(listing => {
            listing.style.display = 'none';
          });

          listingsData.forEach((listing, index) => {
            if (listing.tags.includes(tag) || tag === 'All') {
              listings[index].style.display = 'flex';
            }
          });
          
            // Update active chip
  filterChips.forEach(chip => {
    chip.classList.remove('active');
    if (chip.dataset.filter === tag) {
      chip.classList.add('active');
    }
  });
        }
        
        
        
        
        
     
        
        /** Listings **/
        const listingsContainer = document.getElementById('listings-list');

        function renderListings() {
            listingsContainer.innerHTML = ''; // Clear existing list [cite: 286, 287]

        listingsData.forEach(listing => {
  const listItem = document.createElement('li');

  const photo = document.createElement('img');
  photo.src = listing.imageUrl;
  listItem.appendChild(photo);

  if (listing.badge) { // Check if listing.badge has a value
    const badge = document.createElement('div');
    badge.textContent = listing.badge; // Use the badge string as text
    badge.classList.add('best-seller-badge');
    listItem.appendChild(badge);
  }

  const detailsContainer = document.createElement('div');
  detailsContainer.classList.add('details-container');

  const title = document.createElement('h3');
  title.textContent = listing.shortenedTitle;
  detailsContainer.appendChild(title);

  const subtitle = document.createElement('p');
  subtitle.textContent = listing.subtitle;
  detailsContainer.appendChild(subtitle);

  listItem.appendChild(detailsContainer);

 const buttonsContainer = document.createElement('div');
  buttonsContainer.classList.add('buttons-container');

  const viewStoresRow = document.createElement('div'); // New container for label and buttons
  viewStoresRow.classList.add('view-stores-row');
  buttonsContainer.appendChild(viewStoresRow);

  const viewOnLabel = document.createElement('div');
  viewOnLabel.textContent = 'View on:';
  viewOnLabel.classList.add('view-on-label');
  viewStoresRow.appendChild(viewOnLabel);

  const storesContainer = document.createElement('div');
  storesContainer.classList.add('stores-container');
  viewStoresRow.appendChild(storesContainer);

  // Refined button creation
const createStoreButton = (href, logoSrc, altText, className) => {
    const button = document.createElement('a');
    button.href = href;
    button.classList.add('store-button', className);
    button.target = '_blank';
  
/**   button.onclick = () => { // Track click
 gtag('event', 'product_click', {
 'item_id': listing.listingId,
 'item_name': listing.title,
 'item_category': listing.tags.join(', '),
 'item_list_name': itemListName,
 'item_list_id': itemListId,
 'destination_url': href, // URL clicked
 'store': altText // E.g., 'Etsy', 'Amazon'
 });
 }; */

    const logo = document.createElement('img');
    logo.src = logoSrc;
    logo.alt = altText; // Accessibility
    button.appendChild(logo);

    const text = document.createElement('span');
    text.textContent = altText;
    text.classList.add('button-text'); // For visually hidden text
    button.appendChild(text);

    storesContainer.appendChild(button);
  };

  if (listing.etsyLink) {
    createStoreButton(listing.etsyLink, 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgMnHEM_czqumrqkrOc3rHteFx2lJxC7PF1NtA2Sj7wWa5p9KvCDwhJ_MdNl1Bcq8pTpJ2Wzk5Uu5wTSFyCs5vRD8z6ZuGQxYAinK6sROfV658qpkOMuaEqXQB6JOy8YLLyQr15qqb1F8PP3ftsNSv1Xjjx0PtZ8q2JRBwzDMTLnX1YuwP-YmapvS0dVfDb/s1600/Etsy%20Logo.png', 'Etsy', 'etsy-button');
  }

  if (listing.amazonLink) {
    createStoreButton(listing.amazonLink, 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjlIR0SAB3jtUQywGjoPyNdYu8QXjHGoshQ1_DzGfA3AWGsjAgH3LZsUQ6kFsHAyuuMjD6Ua5DyW9l6l-L_bNYOR9NwzpXUhi6uU1d5ZsRC3iYv9Jn9gtLVogDADnTJaWD7USRO52Q0ZtSaMg1Z7JQJWXmn9WR-D0zYeOIKPk94kjJU5GDY9tzSg64Lj_y2/s1600/Amazon%20Logo.png', 'Amazon', 'amazon-button');
  }

  if (listing.michaelsLink) {
    createStoreButton(listing.michaelsLink, 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg__AD_hRG5KhCOV8Ii_iRDwW0vh9LH-a28a2NP1k9PVNmnF94deuclF0tsOd4BYXT1wqJR_EDh9jlmtuxFU7Z_WpkW9F93gFpzDflGu3Q0fnR4haT14P38WDMZHr6Y-Pfx0t3mkva-y6hZLvBOQGq5xX9TBkEpQhqYMQHoMtH1op1Rg11YdISVHRJQxBFY/s1600/Michaels%20Logo.png', 'Michaels', 'michaels-button');
  }

  listItem.appendChild(buttonsContainer);
          
          
           // Track impression
/** gtag('event', 'product_impression', { 
 'item_id': listing.listingId,
 'item_name': listing.title,
 'item_category': listing.tags.join(', '), // Join tags into a string
 'item_list_name': itemListName,
 'item_list_id': itemListId,
 }); */
          
          // On Click
          
             
           listItem.addEventListener('click', () => {
    openLightbox(listing);
  });
          
          
 listingsContainer.appendChild(listItem);
 setTimeout(() => {
 listItem.classList.add('fade-in');
 }, 10); // Add class with a slight delay
 });
 }
     /* Query param */
        
        function getQueryParam(param) {
  const urlParams = new URLSearchParams(window.location.search);
  return urlParams.get(param);
}
   
      
        
       const sortBySelect = document.getElementById('sort-by');
        let currentSort = 'default'; // Track current sort order

        // Function to sort listings
function sortListings() {
  currentSort = sortBySelect.value;
  sortListingsData(); // Sort the data first
   renderListings(); // Re-render the list
 filterListings(document.querySelector('.filter-chip.active').dataset.filter); // Re-filter to apply the sort
}

function sortListingsData() {
  if (currentSort === 'az') {
    listingsData.sort((a, b) => a.title.localeCompare(b.title));
  } else if (currentSort === 'popular') {
    listingsData.sort((a, b) => {      
      return b.rankingOrder - a.rankingOrder;
    });
  } else {
    // For 'default' or any other case, you might want to keep the original order or sort by a different criteria (e.g., popularity)
    // For now, let's assume original order is "most popular" and do nothing
  }
}

// Initial display and sort
sortListings();

// Add event listener for sort select change
sortBySelect.addEventListener('change', sortListings);
        
          
// Initial filter on page load
const initialFilter = getQueryParam('filter');
if (initialFilter) {
  filterListings(initialFilter);
} 

}
     
